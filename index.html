<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿç©ºç»½æ”¾-ä¸ºä½ è€Œé—ªè€€</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
body {
    color: #fff;
    font-family: 'Microsoft YaHei', sans-serif;
    overflow: hidden;
    height: 100vh;
    cursor: default;
    position: relative;
}

/* æ–°å¢é®ç½©å±‚ */
body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        url('http://vcg00.cfp.cn/creative/vcg/800/new/VCG211438148663.jpg');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    z-index: -1; /* ç¡®ä¿åœ¨èƒŒæ™¯å±‚ */
    filter: brightness(0.2); /* é™ä½50%äº®åº¦ */
}

        .container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        #fireworksCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .floating-texts {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }
        
        .floating-text {
            position: absolute;
            white-space: nowrap;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
            animation: floatText linear;
            animation-fill-mode: forwards;
            opacity: 0.5;
            transition: transform 0.5s ease-out;
        }
        
        @keyframes floatText {
            from {
                transform: translateX(100vw);
            }
            to {
                transform: translateX(-100%);
            }
        }
        
		 .button-container {
			   
			    position: absolute;
			   bottom: 10px;
			    left: 0;
			    
			     z-index: 200;
			     display: flex;
			     gap: 12px;
			     transition: all 0.3s ease;
			     opacity: 1;
			    justify-content: flex-start;
			     width: 100%;
			    margin: 0 auto;
			    padding: 5px;
			   animation: slide 15s linear infinite;
               overflow-x: auto; /* æ·»åŠ æ°´å¹³æ»šåŠ¨ */
               white-space: nowrap; /* é˜²æ­¢æŒ‰é’®æ¢è¡Œ */
               scrollbar-width: none; /* éšè—æ»šåŠ¨æ¡ */
			}
			
				/* æ·»åŠ éšè—æ»šåŠ¨æ¡æ ·å¼ */
			.button-container::-webkit-scrollbar {
			    display: none;
			}
			
		@media (orientation: portrait) {
			    .control-button {
			        min-width: 85px;
			        padding: 8px 12px;
			        font-size: 10px;
			    }
			}
			
		@media (orientation: landscape) {
			    .control-button {
			        min-width: 75px;
			        padding: 7px 10px;
			        font-size: 9px;
			    }
			}
        
        .control-button {
			    background: linear-gradient(135deg, #ff5e9e, #ff6b9e);
			    border: none;
			    color: white;
			    padding: 10px 16px;
			    border-radius: 20px;
			    font-size: 12px;
			    cursor: pointer;
			    transition: all 0.3s;
			    display: flex;
			    align-items: center;
			    justify-content: center;
			    gap: 6px;
			    box-shadow: 0 4px 8px rgba(255, 94, 158, 0.4);
			    min-width: 110px;
			    font-weight: 600;
			    letter-spacing: 0.5px;
			    position: relative;
			    overflow: hidden;
			}
			        
			.control-button:hover {
			    transform: translateY(-2px);
			    box-shadow: 0 6px 12px rgba(255, 94, 158, 0.6);
			}   
		.control-button::before {
			    content: '';
			    position: absolute;
			    top: -50%;
			    left: -50%;
			    width: 200%;
			    height: 200%;
			    background: linear-gradient(
			        to right,
			        rgba(255,255,255,0) 0%,
			        rgba(255,255,255,0.2) 50%,
			        rgba(255,255,255,0) 100%
			    );
			    transform: rotate(45deg);
			    transition: transform 0.6s;
			}
			
			.control-button:hover::before {
			    transform: translateX(100%) rotate(45deg);
			}
						     
			          
			               
			                         
        .control-button i {
            font-size: 12px;
        }
        
        .control-panel {
            position: absolute;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 220px;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
            transform: scale(0.8);
            transform-origin: bottom right;
            overflow-y: auto;
            max-height: 70vh;
        }
        
        .control-panel.hidden {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.8) translateY(20px);
        }
        
        @media (orientation: portrait) {
            .control-panel {
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%) scale(0.8);
                transform-origin: bottom center;
            }
            .control-panel.hidden {
                transform: translateX(-50%) scale(0.8) translateY(20px);
            }
        }
        
        @media (orientation: landscape) {
            .control-panel {
                bottom: 80px;
                right: 16px;
            }
        }
        
        .control-panel h3 {
            margin-bottom: 12px;
            color: #ffb6c1;
            font-size: 14.4px;
            text-align: center;
            text-shadow: 0 0 4px rgba(255, 182, 193, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .slider-container {
            margin: 9.6px 0;
        }
        
        label {
            display: block;
            margin-bottom: 6.4px;
            color: #e0c3fc;
            font-size: 11.2px;
            display: flex;
            align-items: center;
        }
        
        label i {
            margin-right: 8px;
            width: 16px;
            text-align: center;
            font-size: 12.8px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 4.8px;
            background: #4a2a7a;
            border-radius: 2.4px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14.4px;
            height: 14.4px;
            background: #ff5e9e;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 4px rgba(255, 94, 158, 0.8);
        }
        
        .level-indicator {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 10px;
            color: #e0c3fc;
        }
        
        .level-mark {
            width: 20px;
            text-align: center;
        }
        
        .top-controls {
            position: absolute;
            top: 30px;
            right: 20px;
            z-index: 300;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.0);
            padding: 10px 15px;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 10px rgba(0, 173, 238, 0.4);
        }
        
        .firework-counter {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #e0c3fc;
        }
        
        .firework-counter i {
            margin-right: 8px;
            color: #ff5e9e;
        }
        
        .audio-control {
            cursor: pointer;
        }
        
        .audio-control i {
            font-size: 20px;
            color: #ff5e9e;
        }
        
        .tv-box {
            position: absolute;
            z-index: 100;
            background: rgba(0, 0, 0, 0.75);
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 0 20px rgba(0, 173, 238, 0.6);
            border: 1.6px solid #00adee;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            width: 160px;
            transform: scale(0.8);
            transform-origin: bottom right;
        }
        
        .tv-box.hidden {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.8) translateY(20px);
        }
        
        @media (orientation: portrait) {
            .tv-box {
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%) scale(0.8);
                transform-origin: bottom center;
            }
            .tv-box.hidden {
                transform: translateX(-50%) scale(0.8) translateY(20px);
            }
        }
        
        @media (orientation: landscape) {
            .tv-box {
                bottom: 80px;
                right: 16px;
            }
        }
        
        .tv-header {
            display: flex;
            align-items: center;
            margin-bottom: 9.6px;
        }
        
        .tv-logo {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #00adee, #00c9ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
        }
        
        .tv-title {
            font-size: 12.8px;
            font-weight: bold;
            background: linear-gradient(to right, #00adee, #00c9ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 4px rgba(0, 173, 238, 0.4);
        }
        
        .tv-screen {
            width: 100%;
            height: 96px;
            background: #000;
            border-radius: 6.4px;
            overflow: hidden;
            position: relative;
            border: 1.6px solid #444;
            box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.7);
            margin-bottom: 9.6px;
        }
        
        .tv-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1.2s ease-in-out;
        }
        
        .tv-image.active {
            opacity: 1;
        }
        
        .tv-info {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 6.4px;
            padding: 8px;
            border: 0.8px solid rgba(255, 255, 255, 0.15);
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6.4px;
            font-size: 10.4px;
            align-items: center;
        }
        
        .info-item:last-child {
            margin-bottom: 0;
        }
        
        .info-label {
            color: #e0c3fc;
            display: flex;
            align-items: center;
        }
        
        .info-label i {
            margin-right: 4.8px;
            font-size: 9.6px;
            color: #00adee;
        }
        
        .info-value {
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 0 0 2.4px rgba(255, 204, 0, 0.5);
            font-size: 10.4px;
            display: flex;
            align-items: center;
        }
        
        .tv-antenna {
            position: absolute;
            top: -16px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 28px;
        }
        
        .antenna {
            width: 1.6px;
            height: 16px;
            background: #00adee;
            position: relative;
            border-radius: 1.6px;
        }
        
        .antenna::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -2.4px;
            width: 7.2px;
            height: 7.2px;
            border-radius: 50%;
            background: #00adee;
            box-shadow: 0 0 4.8px rgba(0, 173, 238, 0.8);
        }
        
        .page-title {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            text-shadow: 0 0 10px rgba(255, 105, 180, 0.8);
            max-width: 80%;
        }
        
        .page-title h1 {
            font-size: 24px;
            background: linear-gradient(to right, #ff5e9e, #ffcc00, #00adee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
            line-height: 1.2;
        }
        
        .page-title p {
            font-size: 15px;
            color: #e0c3fc;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            padding: 25px 35px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #00adee;
            box-shadow: 0 0 25px rgba(0, 173, 238, 0.8);
        }
        
        .loading-indicator p {
            margin-top: 20px;
            color: #e0c3fc;
            font-size: 16px;
            max-width: 300px;
            line-height: 1.5;
        }
        
        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid #00adee;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-message {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            font-size: 14px;
            color: #ffcc00;
            max-width: 300px;
        }
        
        .heart-icon {
            color: #ff5e9e;
            margin-right: 1px;
            text-shadow: 0 0 5px rgba(255, 94, 158, 0.8);
        }
        
        .mood-icons {
            display: flex;
            gap: 2.4px;
        }
        
        .mood-icon {
            color: #ff5e9e;
            text-shadow: 0 0 2.4px rgba(255, 94, 158, 0.8);
            font-size: 10px;
        }
        
        .resource-status {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.6);
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-icon {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-icon.local {
            background-color: #66ff66;
            box-shadow: 0 0 5px #66ff66;
        }
        
        .status-icon.network {
            background-color: #ffcc00;
            box-shadow: 0 0 5px #ffcc00;
        }
        
        .status-icon.failed {
            background-color: #ff6666;
            box-shadow: 0 0 5px #ff6666;
        }
        
        .progress-container {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 6px;
            background: linear-gradient(to right, #ff5e9e, #00adee);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .hint-box {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 14px;
            color: #e0c3fc;
            text-align: center;
            z-index: 400;
            opacity: 1;
            transition: opacity 1s ease;
            box-shadow: 0 0 15px rgba(0, 173, 238, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .hint-box.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .hint-box i {
            margin-right: 8px;
            color: #ffcc00;
        }
        
        .notification {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: #ffcc00;
            padding: 10px 15px;
            border-radius: 30px;
            font-size: 14px;
            z-index: 350;
            display: flex;
            align-items: center;
            gap: 8px;
            transform: translateY(0);
            opacity: 1;
            transition: all 0.5s ease;
        }
        
        .notification.hidden {
            transform: translateY(-20px);
            opacity: 0;
            pointer-events: none;
        }
        
        /* ä¸Šä¼ èµ„æºé¢æ¿ */
        .upload-panel {
            margin-top: 15px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .upload-panel h4 {
            color: #ffb6c1;
            margin-bottom: 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .upload-group {
            margin-bottom: 10px;
        }
        
        .upload-label {
            font-size: 11px;
            color: #e0c3fc;
            display: block;
            margin-bottom: 4px;
        }
        
        .upload-input {
            width: 100%;
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #4a2a7a;
            background: rgba(74, 42, 122, 0.3);
            color: white;
            font-size: 11px;
        }
        
        .upload-button {
            background: linear-gradient(135deg, #00adee, #00c9ff);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 5px;
            font-size: 12px;
        }
        
        .upload-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(0, 173, 238, 0.8);
        }
        
        .upload-status {
            font-size: 10px;
            color: #ffcc00;
            margin-top: 5px;
            min-height: 12px;
        }
        
        .upload-section {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
        }
        
        .storage-info {
            font-size: 10px;
            color: #e0c3fc;
            margin-top: 10px;
            padding: 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            text-align: center;
        }
        
        //çš‡å† ğŸ‘‘
		.crown-icon {
		    display: inline-block;
		    margin-right: 8px;
		    font-size: 18px;
		    animation: crownPulse 2s infinite;
		}
		
		@keyframes crownPulse {
		    0% { transform: scale(1); }
		    50% { transform: scale(1.1); }
		    100% { transform: scale(1); }
		}
        
    </style>
</head>
<body>
<canvas id="vortexCanvas" style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:0; display:none;"></canvas>

    <div class="container">
        <canvas id="fireworksCanvas"></canvas>
        
        <div class="floating-texts" id="floatingTexts"></div>
        
        <div class="loading-indicator" id="loadingIndicator">
            <div class="spinner"></div>
            <p>æ­£åœ¨åŠ è½½èµ„æºï¼Œè¯·ç¨å€™...</p>
            <div class="status-message" id="loadingStatus"></div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
        </div>
        
        <div class="hint-box" id="hintBox">
            <i class="fas fa-lightbulb"></i>æç¤ºï¼šä¸‰å‡»å±å¹•ä»»æ„ä½ç½®å¯æ’­æ”¾éŸ³ä¹ğŸµ
        </div>
        
        <div class="notification hidden" id="textNotification">
            <i class="fas fa-info-circle"></i> æ–‡å­—è®¾ç½®å·²æ›´æ–°
        </div>
        
        <div class="page-title">
<h1>æ•´ä¸ªæ˜Ÿç©ºä¸ºä½ è€Œç»½æ”¾ï¼†å°ç‡•å­</h1>
            <p>ä¸ºå…·ä½“è€Œç¾å¥½çš„ç”Ÿæ´»å–å½©-åŠ æ²¹</p>
        </div>
        
        <div class="resource-status" id="resourceStatus">
            <div class="status-icon local" id="musicStatus"></div>
            <span>éŸ³ä¹</span>
            <div class="status-icon local" id="soundStatus"></div>
            <span>éŸ³æ•ˆ</span>
            <div class="status-icon local" id="imageStatus"></div>
            <span>å›¾ç‰‡</span>
            <div class="status-icon local" id="textStatus"></div>
            <span>æ–‡å­—</span>
        </div>
        
        <div class="top-controls">
			<div class="firework-counter">
			    <span class="crown-icon">ğŸ‘‘</span> çƒŸèŠ±ç»½æ”¾: <span id="fireworkCount">0</span>
			</div>
            <div class="audio-control" id="audioControl">
                <i class="fas fa-volume-up"></i>
            </div>
        </div>
        
        <div class="control-panel hidden" id="controlPanel">
            <h3><i class="fas fa-sliders-h"></i> æ§åˆ¶é¢æ¿</h3>
            <div class="slider-container">
                <label for="fireworkFrequency"><i class="fas fa-bolt"></i> çƒŸèŠ±é¢‘ç‡</label>
                <input type="range" id="fireworkFrequency" min="0" max="20" value="2">
            </div>
            <div class="slider-container">
                <label for="textFrequency"><i class="fas fa-font"></i> æ–‡å­—é¢‘ç‡ </label>
                <input type="range" id="textFrequency" min="0" max="2" value="1">
                <div class="level-indicator">
                    <span class="level-mark">0</span>
                    <span class="level-mark">1</span>
                    <span class="level-mark">2</span>
                </div>
            </div>
            <div class="slider-container">
                <label for="textSpeed"><i class="fas fa-tachometer-alt"></i> æ–‡å­—é€Ÿåº¦ </label>
                <input type="range" id="textSpeed" min="0" max="2" value="1">
                <div class="level-indicator">
                    <span class="level-mark">0</span>
                    <span class="level-mark">1</span>
                    <span class="level-mark">2</span>
                </div>
            </div>
            <div class="slider-container">
                <label for="musicVolume"><i class="fas fa-music"></i> éŸ³ä¹éŸ³é‡</label>
                <input type="range" id="musicVolume" min="0" max="100" value="50">
            </div>
            <div class="slider-container">
                <label for="soundVolume"><i class="fas fa-volume"></i> éŸ³æ•ˆéŸ³é‡</label>
                <input type="range" id="soundVolume" min="0" max="100" value="30">
            </div>
            
            <!-- ä¸Šä¼ èµ„æºé¢æ¿ -->
            <div class="upload-panel">
                <h4><i class="fas fa-cloud-upload-alt"></i> ä¸Šä¼ èµ„æº</h4>
                
                <div class="upload-group">
                    <label class="upload-label" for="backgroundMusicUpload">
                        <i class="fas fa-music"></i> èƒŒæ™¯éŸ³ä¹
                    </label>
                    <input type="file" id="backgroundMusicUpload" class="upload-input" accept="audio/*">
                    <div class="upload-status" id="musicUploadStatus"></div>
                </div>
                
                <div class="upload-group">
                    <label class="upload-label" for="fireworkSoundUpload">
                        <i class="fas fa-fire"></i> çƒŸèŠ±éŸ³æ•ˆ
                    </label>
                    <input type="file" id="fireworkSoundUpload" class="upload-input" accept="audio/*">
                    <div class="upload-status" id="soundUploadStatus"></div>
                </div>
                
                <div class="upload-group">
                    <label class="upload-label" for="imageUpload">
                        <i class="fas fa-image"></i> å›¾ç‰‡ (æœ€å¤š5å¼ )
                    </label>
                    <input type="file" id="imageUpload" class="upload-input" accept="image/*" multiple>
                    <div class="upload-status" id="imageUploadStatus"></div>
                </div>
                
                <div class="upload-group">
                    <label class="upload-label" for="textUpload">
                        <i class="fas fa-font"></i> æ–‡å­— (æ–‡æœ¬æ–‡ä»¶)
                    </label>
                    <input type="file" id="textUpload" class="upload-input" accept=".txt">
                    <div class="upload-status" id="textUploadStatus"></div>
                </div>
                
                <button class="upload-button" id="applyUploadsButton">
                    <i class="fas fa-check"></i> åº”ç”¨æ‰€æœ‰ä¸Šä¼ 
                </button>
            </div>
        </div>
        
        <div class="tv-box hidden" id="tvBox">
            <div class="tv-antenna">
                <div class="antenna"></div>
                <div class="antenna"></div>
            </div>
            <div class="tv-header">
                <div class="tv-logo">
                    <i class="fas fa-tv" style="color: white; font-size: 12.8px;"></i>
                </div>
                <div class="tv-title">å°ç”µè§†</div>
            </div>
            <div class="tv-screen">
                <div class="tv-image active" id="tvImage1"></div>
                <div class="tv-image" id="tvImage2"></div>
                <div class="tv-image" id="tvImage3"></div>
                <div class="tv-image" id="tvImage4"></div>
            </div>
            <div class="tv-info">
                <div class="info-item">
                    <span class="info-label">
                    <i class="fas fa-calendar-heart">â¤ï¸</i> ç›¸è¯†å¤©æ•°</span>
                    <span class="info-value"><span id="daysTogether">0</span>å¤©</span>
                </div>
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-thermometer-half"></i> å½“å‰æ¸©åº¦</span>
                    <span class="info-value" id="temperature">26Â°C</span>
                </div>
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-clock"></i> å½“å‰æ—¶é—´</span>
                    <span class="info-value" id="currentTime">00:00:00</span>
                </div>
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-smile"></i> ä»Šæ—¥å¿ƒæƒ…</span>
                    <span class="info-value" id="mood">
                        <div class="mood-icons">
                            <span class="mood-icon">â¤ï¸</span>
                            <span class="mood-icon">â¤ï¸</span>
                            <span class="mood-icon">â¤ï¸</span>
                            <span class="mood-icon">â¤ï¸</span>
                            <span class="mood-icon">â¤ï¸</span>
                        </div>
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-cloud-sun"></i> å¤©æ°”</span>
                    <span class="info-value" id="weather">æ™´ 28Â°C</span>
                </div>
            </div>
        </div>
        
			<!-- ä¿®æ”¹æŒ‰é’®å®¹å™¨ç»“æ„ -->
		<div class="button-container hidden" id="buttonContainer">
		    
		    <button class="control-button" id="panelButton">
		        <i class="fas fa-sliders-h"></i> æ§åˆ¶é¢æ¿
		    </button>
		    <button class="control-button" id="tvButton">
		        <i class="fas fa-tv"></i> å°ç”µè§†
		    </button>
		    <!-- æ·»åŠ æ‰€æœ‰çœä»½æŒ‰é’® -->
		    <button class="control-button" id="beijingButton"><i class="fas fa-landmark"></i> é£æš´æ¼©æ¶¡</button>
		    <button class="control-button" id="tianjinButton"><i class="fas fa-ship"></i> å¤©æ´¥å¸‚</button>
		    <button class="control-button" id="hebeiButton"><i class="fas fa-industry"></i> æ²³åŒ—çœ</button>
		    <button class="control-button" id="shanxiButton"><i class="fas fa-mountain"></i> å±±è¥¿çœ</button>
		    <button class="control-button" id="neimengguButton"><i class="fas fa-horse"></i> å†…è’™å¤</button>
		    <button class="control-button" id="liaoningButton"><i class="fas fa-industry"></i> è¾½å®çœ</button>
		    <button class="control-button" id="jilinButton"><i class="fas fa-snowflake"></i> å‰æ—çœ</button>
		    <button class="control-button" id="heilongjiangButton"><i class="fas fa-snowman"></i> é»‘é¾™æ±Ÿ</button>
		    <button class="control-button" id="shanghaiButton"><i class="fas fa-city"></i> ä¸Šæµ·å¸‚</button>
		    <button class="control-button" id="jiangsuButton"><i class="fas fa-water"></i> æ±Ÿè‹çœ</button>
		    <button class="control-button" id="zhejiangButton"><i class="fas fa-bridge"></i> æµ™æ±Ÿçœ</button>
		    <button class="control-button" id="anhuiButton"><i class="fas fa-hills"></i> å®‰å¾½çœ</button>
		    <button class="control-button" id="fujianButton"><i class="fas fa-ship"></i> ç¦å»ºçœ</button>
		    <button class="control-button" id="jiangxiButton"><i class="fas fa-lake"></i> æ±Ÿè¥¿çœ</button>
		    <button class="control-button" id="shandongButton"><i class="fas fa-mountain"></i> å±±ä¸œçœ</button>
		    <button class="control-button" id="henanButton"><i class="fas fa-wheat"></i> æ²³å—çœ</button>
		    <button class="control-button" id="hubeiButton"><i class="fas fa-water"></i> æ¹–åŒ—çœ</button>
		    <button class="control-button" id="hunanButton"><i class="fas fa-pepper-hot"></i> æ¹–å—çœ</button>
		    <button class="control-button" id="guangdongButton"><i class="fas fa-building"></i> å¹¿ä¸œçœ</button>
		    <button class="control-button" id="guangxiButton"><i class="fas fa-mountain"></i> å¹¿è¥¿</button>
		    <button class="control-button" id="hainanButton"><i class="fas fa-umbrella-beach"></i> æµ·å—çœ</button>
		    <button class="control-button" id="chongqingButton"><i class="fas fa-city"></i> é‡åº†å¸‚</button>
		    <button class="control-button" id="sichuanButton"><i class="fas fa-paw"></i> å››å·çœ</button>
		    <button class="control-button" id="guizhouButton"><i class="fas fa-hills"></i> è´µå·çœ</button>
		    <button class="control-button" id="yunnanButton"><i class="fas fa-mountain"></i> äº‘å—çœ</button>
		    <button class="control-button" id="xizangButton"><i class="fas fa-mountain"></i> è¥¿è—</button>
		    <button class="control-button" id="shaanxiButton"><i class="fas fa-landmark"></i> é™•è¥¿çœ</button>
		    <button class="control-button" id="gansuButton"><i class="fas fa-desert"></i> ç”˜è‚ƒçœ</button>
		    <button class="control-button" id="qinghaiButton"><i class="fas fa-mountain"></i> é’æµ·çœ</button>
		    <button class="control-button" id="ningxiaButton"><i class="fas fa-wind"></i> å®å¤</button>
		    <button class="control-button" id="xinjiangButton"><i class="fas fa-desert"></i> æ–°ç–†</button>
		    <button class="control-button" id="taiwanButton"><i class="fas fa-island-tropical"></i> å°æ¹¾çœ</button>
		    <button class="control-button" id="xianggangButton"><i class="fas fa-shopping-bag"></i> é¦™æ¸¯</button>
		    <button class="control-button" id="aomenButton"><i class="fas fa-casino"></i> æ¾³é—¨</button>
		</div>
		   
		</div>
		
    </div>

    <audio id="backgroundMusic" loop></audio>
    <audio id="fireworkSound"></audio>

    <script>
    
    
    
    
        // çƒŸèŠ±é¢œè‰²
        const colors = [
            '#ff3366', '#ff9933', '#ffcc00', '#66ccff', 
            '#9966ff', '#ff66cc', '#ff5050', '#33cc99',
            '#66ff66', '#66ccff', '#ffcc66', '#cc99ff',
            '#ff3399', '#33ccff', '#ff9966', '#66ffcc'
        ];
        
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        
        // éŸ³é¢‘å…ƒç´ 
        const backgroundMusic = document.getElementById('backgroundMusic');
        const fireworkSound = document.getElementById('fireworkSound');
        const audioControl = document.getElementById('audioControl');
        
        // è®¾ç½®åˆå§‹éŸ³é‡
        backgroundMusic.volume = 0.5;
        fireworkSound.volume = 0.3;
        
        // è®¾ç½®éŸ³é¢‘æ§åˆ¶æŒ‰é’®äº‹ä»¶
        let isMuted = false;
        audioControl.addEventListener('click', function() {
            isMuted = !isMuted;
            backgroundMusic.muted = isMuted;
            fireworkSound.muted = isMuted;
            
            this.innerHTML = isMuted ? 
                '<i class="fas fa-volume-mute"></i>' : 
                '<i class="fas fa-volume-up"></i>';
        });
        
        // è®¾ç½®Canvaså¤§å°ä¸ºçª—å£å¤§å°
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        // åˆå§‹åŒ–Canvaså¤§å°
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // çƒŸèŠ±è®¡æ•°å™¨
        let fireworkCounter = 0;
        const fireworkCountEl = document.getElementById('fireworkCount');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const loadingStatus = document.getElementById('loadingStatus');
        const progressBar = document.getElementById('progressBar');
        const hintBox = document.getElementById('hintBox');
        const textNotification = document.getElementById('textNotification');
        const buttonContainer = document.getElementById('buttonContainer');
        const daysTogether = document.getElementById('daysTogether');
        
        // èµ„æºçŠ¶æ€å…ƒç´ 
        const musicStatus = document.getElementById('musicStatus');
        const soundStatus = document.getElementById('soundStatus');
        const imageStatus = document.getElementById('imageStatus');
        const textStatus = document.getElementById('textStatus');
        
        // æ›´æ–°èµ„æºçŠ¶æ€æ˜¾ç¤º
        function updateResourceStatus(element, status) {
            element.classList.remove('local', 'network', 'failed');
            switch(status) {
                case 'local': element.classList.add('local'); break;
                case 'network': element.classList.add('network'); break;
                case 'failed': element.classList.add('failed'); break;
            }
        }
        
        // ç›¸è¯†æ—¥æœŸï¼ˆ2024å¹´3æœˆ12æ—¥ï¼‰
        const startDate = new Date(2024, 2, 12);
        
        // è®¡ç®—ç›¸è¯†å¤©æ•°
        function calculateDaysTogether() {
            const today = new Date();
            const timeDiff = today.getTime() - startDate.getTime();
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            daysTogether.textContent = `${days}`;
            return days;
        }
        
        // åŠ è½½æš–å¿ƒæ–‡å­—
        let warmTexts = [];
        async function loadWarmTexts() {
            // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½è‡ªå®šä¹‰æ–‡æœ¬
            const customTexts = localStorage.getItem('customWarmTexts');
            if (customTexts) {
                warmTexts = JSON.parse(customTexts);
                updateResourceStatus(textStatus, 'local');
                return { success: true, message: 'è‡ªå®šä¹‰æš–å¿ƒæ–‡å­—åŠ è½½æˆåŠŸ' };
            }
            
            try {
                const response = await fetch('text/warm_texts.txt');
                if (response.ok) {
                    const text = await response.text();
                    warmTexts = text.split('\n').filter(line => line.trim() !== '');
                    updateResourceStatus(textStatus, 'local');
                    return { success: true, message: 'æœ¬åœ°æš–å¿ƒæ–‡å­—åŠ è½½æˆåŠŸ' };
                }
            } catch (error) {
                console.log('æœ¬åœ°æ–‡å­—åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å†…ç½®æ–‡å­—');
            }
            
            // å†…ç½®æ–‡å­—
            warmTexts = [
                "ç´¯äº†æ­‡ä¼šå„¿ï¼Œåˆ«ç¡¬æ’‘å‘€ï¼Œä¸ç„¶ä¸‹ä¸€ç§’å¯èƒ½å°±å˜æˆ'è‘›ä¼˜èºº'å•¦",
                "æ„¿æˆ‘ä»¬æºæ‰‹èµ°è¿‡æ›´å¤šç¾å¥½æ—¶å…‰",
                "æ¯ä¸€å¤©éƒ½å› ä½ è€Œæ›´åŠ ç²¾å½©",
                "å¿ƒæ€€å¸Œæœ›ï¼Œæœªæ¥å¯æœŸ",
                "ä½ æ˜¯ç‹¬ä¸€æ— äºŒçš„å­˜åœ¨",
                "ç”Ÿæ´»å› ä½ è€Œç¾å¥½",
                "åšæŒæ¢¦æƒ³ï¼Œç»ˆä¼šå‘å…‰",
                "å¾®ç¬‘é¢å¯¹æ¯ä¸€å¤©",
                "ä½ å€¼å¾—æ‹¥æœ‰æœ€å¥½çš„",
                "å›°éš¾åªæ˜¯æš‚æ—¶çš„",
                "ç›¸ä¿¡è‡ªå·±çš„åŠ›é‡",
                "é˜³å…‰æ€»åœ¨é£é›¨å",
                "çˆ±è‡ªå·±ï¼Œæ˜¯ç»ˆèº«æµªæ¼«çš„å¼€å§‹",
                "ä¿æŒçƒ­çˆ±ï¼Œå¥”èµ´å±±æµ·",
                "ä½ çš„åŠªåŠ›ç»ˆå°†å¼€èŠ±ç»“æœ",
                "ä¸–ç•Œå› ä½ è€Œä¸åŒ",
                "æ¯ä¸€å¤©éƒ½æ˜¯ç”Ÿå‘½çš„ç¤¼ç‰©",
                "åšæŒåšå¯¹çš„äº‹ï¼Œæ—¶é—´ä¼šç»™ä½ ç­”æ¡ˆ",
                "æ„¿ä½ è¢«çˆ±åŒ…å›´ï¼Œå¹¸ç¦å¸¸åœ¨",
                "ä¿æŒå–„è‰¯ï¼Œä¿æŒåŠªåŠ›",
                "æœ€ç¾çš„é£æ™¯åœ¨è·¯ä¸Š",
                "æœªæ¥çš„è·¯ï¼Œå¸Œæœ›èƒ½ä¸€è·¯åŒè¡Œ",
                "çš±çœ‰å¤´å•¦ï¼Ÿç¬‘ä¸€ç¬‘å¥½çœ‹,ä¸ç„¶çš±çº¹éƒ½è¦è¢«ä½ æŒ¤å‡ºæ¥å¼€ä¼šå•¦",
                "èµ°,çœ‹åœºç”µå½±æ”¾æ¾ä¸‹,ä¸å»å½“è§‚ä¼—,éš¾é“è¦åœ¨å®¶å½“'æ²™å‘åœŸè±†'å—ï¼Ÿ",
                "ä»Šå¤©è¾›è‹¦å•¦,å–å£æ°´å§,ä¸ç„¶å˜´å·´éƒ½è¦å¹²æˆ'æ’’å“ˆæ‹‰æ²™æ¼ 'å•¦",
                "åˆ«æ€¥åˆ«æ…Œ,æˆ‘é™ªä½ å¼„,æˆ‘å¯æ˜¯ä½ ä¸“å±çš„'ä¸‡èƒ½å°åŠ©æ‰‹'å“¦",
                "æ–¹æ¡ˆä¸æ€¥,æ€è·¯æ¸…æ™°æ›´é‡è¦,åˆ«è®©è„‘è¢‹å˜æˆ'æµ†ç³Šæ…æ‹Œæœº'å•¦",
                "è‚©è†€ç»·å¤ªç´§ï¼Ÿæ‰æ‰ä¼šå¥½äº›,æ¥,è®©æˆ‘ç»™ä½ æ¥ä¸ª'è¶…çº§é©¬æ€é¸¡'",
                "æ˜Ÿæ˜Ÿè¿˜äº®ç€,å¤©å¡Œä¸ä¸‹æ¥,å°±ç®—å¡Œä¸‹æ¥ä¹Ÿæœ‰æˆ‘è¿™ä¸ª'äººè‚‰å«å­'åœ¨å‘¢",
                "æ”¾ä¸‹æ‰‹æœº,æˆ‘ä»¬å‡ºå»èµ°èµ°å•¦,ä¸ç„¶çœ¼ç›éƒ½è¦å˜æˆ'ç”µå­å±å¹•ç›‘æ§å™¨'å•¦",
                "è¿™äº‹å„¿è¿‡äº†,è¯·ä½ åƒå¤§é¤,å’±ä»¬å»æŠŠè‚šå­æ’‘æˆä¸ª'ç§»åŠ¨çš„å°ä»“åº“'",
                "æˆ‘å¯èƒ½ä¸æ“…é•¿è¯´æƒ…è¯ï¼Œä½†ä¼šç”¨è¡ŒåŠ¨æŠŠ'æˆ‘å–œæ¬¢ä½ 'å†™è¿›æ¯ä¸€å¤©",
                "é‡è§ä½ åï¼Œæˆ‘çš„ç”Ÿæ´»ä»é»‘ç™½é»˜ç‰‡å˜æˆäº†4Kå…¨å½©ç”µå½±"
            ];
            
            updateResourceStatus(textStatus, 'network');
            return { success: true, message: 'å†…ç½®æš–å¿ƒæ–‡å­—åŠ è½½æˆåŠŸ' };
        }
        
        // åŠ è½½éŸ³é¢‘èµ„æº
        async function loadAudio() {
            let musicLoaded = false;
            let soundLoaded = false;
            
// æ·»åŠ æœ¬åœ°è·¯å¾„åŠ è½½èƒŒæ™¯éŸ³ä¹
    try {
        backgroundMusic.src = 'musics/background.mp3'; // ä¿®æ”¹ä¸ºä½ çš„æœ¬åœ°éŸ³ä¹è·¯å¾„
        await new Promise((resolve, reject) => {
            backgroundMusic.oncanplaythrough = resolve;
            backgroundMusic.onerror = () => reject(new Error('æœ¬åœ°éŸ³ä¹åŠ è½½å¤±è´¥'));
        });
        musicLoaded = true;
        updateResourceStatus(musicStatus, 'local');
        console.log('æœ¬åœ°èƒŒæ™¯éŸ³ä¹åŠ è½½æˆåŠŸ');
    } catch (localError) {
        console.log('æœ¬åœ°èƒŒæ™¯éŸ³ä¹åŠ è½½å¤±è´¥', localError);
        // ç»§ç»­å°è¯•å…¶ä»–åŠ è½½æ–¹å¼...
    }

    // æ·»åŠ æœ¬åœ°è·¯å¾„åŠ è½½éŸ³æ•ˆ
    try {
        fireworkSound.src = 'musics/firework.mp3'; // ä¿®æ”¹ä¸ºä½ çš„æœ¬åœ°éŸ³æ•ˆè·¯å¾„
        await new Promise((resolve, reject) => {
            fireworkSound.oncanplaythrough = resolve;
            fireworkSound.onerror = () => reject(new Error('æœ¬åœ°éŸ³æ•ˆåŠ è½½å¤±è´¥'));
        });
        soundLoaded = true;
        updateResourceStatus(soundStatus, 'local');
        console.log('æœ¬åœ°éŸ³æ•ˆåŠ è½½æˆåŠŸ');
    } catch (localError) {
        console.log('æœ¬åœ°éŸ³æ•ˆåŠ è½½å¤±è´¥', localError);
        // ç»§ç»­å°è¯•å…¶ä»–åŠ è½½æ–¹å¼...
    }
            /**
            
            // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½èƒŒæ™¯éŸ³ä¹
            const customMusic = localStorage.getItem('music/background.mp3');
            if (customMusic) {
                backgroundMusic.src = customMusic;
                try {
                    await new Promise((resolve, reject) => {
                        backgroundMusic.oncanplaythrough = resolve;
                        backgroundMusic.onerror = () => reject(new Error('åŠ è½½å¤±è´¥'));
                    });
                    musicLoaded = true;
                    updateResourceStatus(musicStatus, 'local');
                } catch (e) {
                    console.log('è‡ªå®šä¹‰èƒŒæ™¯éŸ³ä¹åŠ è½½å¤±è´¥');
                }
            }
            
            // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½éŸ³æ•ˆ
            const customSound = localStorage.getItem('customFireworkSoundï¼Ÿ');
            if (customSound) {
                fireworkSound.src = customSound;
                try {
                    await new Promise((resolve, reject) => {
                        fireworkSound.oncanplaythrough = resolve;
                        fireworkSound.onerror = () => reject(new Error('éŸ³æ•ˆåŠ è½½å¤±è´¥'));
                    });
                    soundLoaded = true;
                    updateResourceStatus(soundStatus, 'local');
                } catch (e) {
                    console.log('è‡ªå®šä¹‰éŸ³æ•ˆåŠ è½½å¤±è´¥');
                }
            }
            **/
            // å¦‚æœè‡ªå®šä¹‰èµ„æºåŠ è½½å¤±è´¥ï¼Œå°è¯•ç½‘ç»œèµ„æº
            if (!musicLoaded) {
                try {
                    backgroundMusic.src = 'https://music.163.com/song/media/outer/url?id=1413863166.mp3';
                    await new Promise((resolve, reject) => {
                        backgroundMusic.oncanplaythrough = resolve;
                        backgroundMusic.onerror = () => reject(new Error('éŸ³ä¹åŠ è½½å¤±è´¥'));
                    });
                    musicLoaded = true;
                    updateResourceStatus(musicStatus, 'network');
                } catch (e) {
                    console.log('ç½‘ç»œèƒŒæ™¯éŸ³ä¹åŠ è½½å¤±è´¥');
                    updateResourceStatus(musicStatus, 'failed');
                }
            }
            
            if (!soundLoaded) {
                try {
                    fireworkSound.src = '';
                    await new Promise((resolve, reject) => {
                        fireworkSound.oncanplaythrough = resolve;
                        fireworkSound.onerror = () => reject(new Error('éŸ³æ•ˆåŠ è½½å¤±è´¥'));
                    });
                    soundLoaded = true;
                    updateResourceStatus(soundStatus, 'network');
                } catch (e) {
                    console.log('ç½‘ç»œéŸ³æ•ˆåŠ è½½å¤±è´¥');
                    updateResourceStatus(soundStatus, 'failed');
                }
            }
            
            return { music: musicLoaded, sound: soundLoaded };
        }
        
        // åŠ è½½å›¾ç‰‡
        async function loadImages() {
            const tvImages = document.querySelectorAll('.tv-image');
            let loadedCount = 0;
            let usedCustom = false;
            let usedNetwork = false;
            
            // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½è‡ªå®šä¹‰å›¾ç‰‡
	            for (let i = 0; i < 5; i++) {
                const customImage = localStorage.getItem(`customImage${i}`);
                if (customImage) {
                    tvImages[i].style.backgroundImage = `url('${customImage}')`;
                    loadedCount++;
                    usedCustom = true;
                }
            }
            
            if (loadedCount === 5) {
                updateResourceStatus(imageStatus, 'local');
                return { success: true, message: 'è‡ªå®šä¹‰å›¾ç‰‡åŠ è½½æˆåŠŸ' };
            }
            
            // å›¾ç‰‡èµ„æº
            const imageSources = [
                ['image/image1.jpg', 'https://images.unsplash.com/photo-1501854140801-50d01698950b?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=300&w=400'],
                ['image/image2.jpg', 'https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=300&w=400'],
                ['image/image3.jpg', 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=300&w=400'],
                ['image/image4.jpg', 'https://images.unsplash.com/photo-1476820865390-c52aeebb9891?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=300&w=400'],
                ['image/image5.jpg', 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=300&w=400']
            ];
            
            // é»˜è®¤å›¾ç‰‡
            const defaultImage = "https://images.unsplash.com/photo-1506744038136-46273834b3fb?crop=entropy&cs=tinysrgb&fit=crop&fm=jpg&h=300&w=400";
            
            for (let i = 0; i < 5; i++) {
                // å¦‚æœè¿™ä¸ªä½ç½®å·²ç»æœ‰è‡ªå®šä¹‰å›¾ç‰‡ï¼Œè·³è¿‡
                if (localStorage.getItem(`customImage${i}`)) continue;
                
                let loaded = false;
                
                // å°è¯•åŠ è½½æœ¬åœ°å›¾ç‰‡
                try {
                    await loadImageWithTimeout(imageSources[i][0], 1500);
                    tvImages[i].style.backgroundImage = `url('${imageSources[i][0]}')`;
                    loaded = true;
                    loadedCount++;
                } catch (error) {
                    console.log(`æœ¬åœ°å›¾ç‰‡ ${i+1} åŠ è½½å¤±è´¥`);
                }
                
                // æœ¬åœ°åŠ è½½å¤±è´¥ï¼Œå°è¯•ç½‘ç»œå›¾ç‰‡
                if (!loaded) {
                    try {
                        await loadImageWithTimeout(imageSources[i][1], 1500);
                        tvImages[i].style.backgroundImage = `url('${imageSources[i][1]}')`;
                        loaded = true;
                        loadedCount++;
                        usedNetwork = true;
                    } catch (error) {
                        console.log(`ç½‘ç»œå›¾ç‰‡ ${i+1} åŠ è½½å¤±è´¥`);
                    }
                }
                
                // å¦‚æœéƒ½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å›¾ç‰‡
                if (!loaded) {
                    tvImages[i].style.backgroundImage = `url('${defaultImage}')`;
                }
            }
            
            // æ›´æ–°å›¾ç‰‡çŠ¶æ€
            if (usedCustom) {
                updateResourceStatus(imageStatus, 'local');
                return { success: true, message: 'å›¾ç‰‡åŠ è½½æˆåŠŸï¼ˆè‡ªå®šä¹‰+é»˜è®¤ï¼‰' };
            } else if (loadedCount === 4 && !usedNetwork) {
                updateResourceStatus(imageStatus, 'local');
                return { success: true, message: 'å›¾ç‰‡åŠ è½½æˆåŠŸï¼ˆæœ¬åœ°ï¼‰' };
            } else if (loadedCount === 4 && usedNetwork) {
                updateResourceStatus(imageStatus, 'network');
                return { success: true, message: 'å›¾ç‰‡åŠ è½½æˆåŠŸï¼ˆç½‘ç»œï¼‰' };
            } else {
                updateResourceStatus(imageStatus, 'failed');
                return { success: false, message: `${4 - loadedCount}å¼ å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å›¾ç‰‡` };
            }
        }
        
        // å¸¦è¶…æ—¶çš„å›¾ç‰‡åŠ è½½
        function loadImageWithTimeout(src, timeout) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                const timer = setTimeout(() => {
                    img.onload = null;
                    img.onerror = null;
                    reject(new Error('å›¾ç‰‡åŠ è½½è¶…æ—¶'));
                }, timeout);
                
                img.onload = () => {
                    clearTimeout(timer);
                    resolve();
                };
                
                img.onerror = () => {
                    clearTimeout(timer);
                    reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
                };
                
                img.src = src;
            });
        }
        
        // åˆå§‹åŒ–èµ„æºåŠ è½½
        async function initResources() {
            loadingIndicator.style.display = 'block';
            let statusMessages = [];
            let loadedCount = 0;
            const totalResources = 4;
            
            // æ›´æ–°è¿›åº¦æ¡
            function updateProgress() {
                loadedCount++;
                const percent = Math.min(100, Math.round((loadedCount / totalResources) * 100));
                progressBar.style.width = `${percent}%`;
            }
            
            try {
                // å¹¶è¡ŒåŠ è½½èµ„æº
                const promises = [
                    loadWarmTexts().then(result => {
                        statusMessages.push(result.message);
                        updateProgress();
                    }),
                    loadAudio().then(result => {
                        statusMessages.push(result.music ? 'éŸ³é¢‘åŠ è½½æˆåŠŸ' : 'èƒŒæ™¯éŸ³ä¹åŠ è½½å¤±è´¥');
                        statusMessages.push(result.sound ? 'éŸ³æ•ˆåŠ è½½æˆåŠŸ' : 'éŸ³æ•ˆåŠ è½½å¤±è´¥');
                        updateProgress();
                        updateProgress(); // éŸ³é¢‘åŒ…å«ä¸¤ä¸ªèµ„æº
                    }),
                    loadImages().then(result => {
                        statusMessages.push(result.message);
                        updateProgress();
                    })
                ];
                
                // è®¾ç½®5ç§’è¶…æ—¶
                await Promise.race([
                    Promise.all(promises),
                    new Promise(resolve => setTimeout(resolve, 5000))
                ]);
                
                loadingStatus.textContent = statusMessages.join('\n');
                loadingStatus.style.color = '#66ff66';
            } catch (error) {
                console.error('èµ„æºåŠ è½½é”™è¯¯:', error);
                loadingStatus.textContent = 'èµ„æºåŠ è½½å®Œæˆï¼Œéƒ¨åˆ†èµ„æºå¯èƒ½æœªåŠ è½½æˆåŠŸ';
                loadingStatus.style.color = '#ffcc00';
            } finally {
                // å»¶è¿Ÿéšè—åŠ è½½æŒ‡ç¤ºå™¨
                setTimeout(() => {
                    loadingIndicator.style.display = 'none';
                    
                    // åœ¨ç”¨æˆ·äº¤äº’åå¼€å§‹æ’­æ”¾éŸ³ä¹
                    document.addEventListener('click', function startMusic() {
                        try {
                            backgroundMusic.play().catch(e => {
                                console.log('éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³é¢‘');
                                // é‡è¯•æ’­æ”¾
                                setTimeout(() => backgroundMusic.play(), 1000);
                            });
                            document.removeEventListener('click', startMusic);
                        } catch (e) {
                            console.log('éŸ³é¢‘æ’­æ”¾é”™è¯¯:', e);
                        }
                    }, { once: true });
                    
                    // æ˜¾ç¤ºæç¤ºæ¡†ï¼Œ5ç§’åè‡ªåŠ¨éšè—
                    setTimeout(() => {
                        hintBox.classList.add('hidden');
                    }, 5000);
                }, 1000);
            }
        }
        
        // çƒŸèŠ±ç±»
        class Firework {
            constructor() {
                this.reset();
                this.id = Date.now() + Math.random().toString(36).substr(2, 9); // å”¯ä¸€ID
            }
            
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = canvas.height;
                this.targetY = Math.random() * canvas.height * 0.4 + 50;
                this.currentX = this.x;
                this.currentY = this.y;
                this.speed = 2 + Math.random() * 3;
                this.size = Math.random() * 2 + 1;
                this.color = colors[Math.floor(Math.random() * colors.length)];
                
               // ä¸ºæ•´ä¸ªçƒŸèŠ±é€‰æ‹©ä¸€ä¸ªéšæœºé¢œè‰²
                this.explosionColor = colors[Math.floor(Math.random() * colors.length)];
                this.particles = [];
                this.state = 0;
            }
            
            update() {
                if (this.state === 0) {
                    this.currentY -= this.speed;
                    if (this.currentY <= this.targetY) {
                        this.explode();
                        fireworkCounter++;
                        fireworkCountEl.textContent = fireworkCounter;
                    }
                } else {
                    for (let i = 0; i < this.particles.length; i++) {
                        this.particles[i].update();
                        if (this.particles[i].alpha <= 0) {
                            this.particles.splice(i, 1);
                            i--;
                        }
                    }
                    if (this.particles.length === 0) {
                        this.reset();
                    }
                }
            }
            
            explode() {
                this.state = 1;
                try {
                    fireworkSound.currentTime = 0;
                    fireworkSound.play().catch(e => console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e));
                } catch (e) {
                    console.log('éŸ³æ•ˆæ’­æ”¾é”™è¯¯:', e);
                }
                
                const particleCount = Math.floor(Math.random() * 200) + 150;
                for (let i = 0; i < particleCount; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 6 + 2;
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed;
                    const size = Math.random() * 2 + 1;
                    
                    
                    const color = this.explosionColor;
                    //const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    this.particles.push({
                        x: this.currentX,
                        y: this.currentY,
                        vx: vx,
                        vy: vy,
                        size: size,
                        color: color,
                        alpha: 1,
                        gravity: 0.05,
                        friction: 0.97,
                        update: function() {
                            this.x += this.vx;
                            this.y += this.vy;
                            this.vy += this.gravity;
                            this.vx *= this.friction;
                            this.vy *= this.friction;
                            this.alpha -= 0.008;
                        }
                    });
                }
            }
            
            draw() {
                if (this.state === 0) {
		// ç»˜åˆ¶ä¸Šå‡è½¨è¿¹çº¿ï¼ˆä¿æŒä¸å˜ï¼‰
		        ctx.beginPath();
		        ctx.moveTo(this.x, canvas.height);
		        ctx.lineTo(this.currentX, this.currentY);
		        ctx.strokeStyle = this.color;
		        ctx.lineWidth = 1;
		        ctx.stroke();
		        
		        // ç»˜åˆ¶çš‡å† å›¾æ ‡ä»£æ›¿åœ†å½¢
		        ctx.font = `${this.size * 4}px Arial`; // æ ¹æ®çƒŸèŠ±å¤§å°è°ƒæ•´å­—ä½“
		        ctx.fillStyle = this.color;
		        ctx.textAlign = 'center';
		        ctx.textBaseline = 'middle';
		        ctx.fillText('ğŸ‘‘', this.currentX, this.currentY);
                } else {
                    for (let i = 0; i < this.particles.length; i++) {
                        const p = this.particles[i];
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(${parseInt(p.color.slice(1, 3), 16)}, ${parseInt(p.color.slice(3, 5), 16)}, ${parseInt(p.color.slice(5, 7), 16)}, ${p.alpha})`;
                        ctx.fill();
                    }
                }
            }
        }
        
        
        // åˆ›å»ºçƒŸèŠ±æ•°ç»„
        const fireworks = [];
        const fireworkCount = 6;
        let fireworkInterval = 80;
        
        // åˆå§‹åŒ–çƒŸèŠ±
        for (let i = 0; i < fireworkCount; i++) {
            fireworks.push(new Firework());
            setTimeout(() => {}, i * fireworkInterval);
        }
        
        // é£˜å±æ–‡å­—ç®¡ç†
        class FloatingTextManager {
            constructor() {
                this.texts = [];
                this.container = document.getElementById('floatingTexts');
                this.lastTextTime = 0;
                // æ–‡å­—é¢‘ç‡ç­‰çº§ (0-5)
                this.textFrequencyLevel = 1;
                // æ–‡å­—é€Ÿåº¦ç­‰çº§ (0-5)
                this.speedLevel = 3;
                // è®°å½•ä¸Šä¸€ä¸ªé¢‘ç‡ç­‰çº§
                this.lastFrequencyLevel = 1;
            }
            
            // æ ¹æ®é¢‘ç‡ç­‰çº§è·å–é—´éš”æ—¶é—´
            getFrequencyInterval() {
                // é¢‘ç‡ç­‰çº§å¯¹åº”çš„é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
                const intervals = [
                    Number.MAX_SAFE_INTEGER, // ç­‰çº§0ï¼šä¸æ˜¾ç¤º
                    1000, // ç­‰çº§1ï¼šæ¯1ç§’ä¸€ä¸ª
                    500, // ç­‰çº§2ï¼šæ¯0.5ç§’ä¸€ä¸ª
                    250, // ç­‰çº§3ï¼šæ¯0.25ç§’ä¸€ä¸ª
                    150,  // ç­‰çº§4ï¼šæ¯0.15ç§’ä¸€ä¸ª
                    50   // ç­‰çº§5ï¼šæ¯0.05ç§’ä¸€ä¸ª
                ];
                return intervals[this.textFrequencyLevel];
            }
            
            // æ ¹æ®é€Ÿåº¦ç­‰çº§è·å–åŠ¨ç”»æŒç»­æ—¶é—´
            getSpeedDuration() {
                // é€Ÿåº¦ç­‰çº§å¯¹åº”çš„åŠ¨ç”»æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
                const durations = [
                    9999, // ç­‰çº§0ï¼šå‡ ä¹ä¸åŠ¨
                    20,   // ç­‰çº§1ï¼š20ç§’
                    10,   // ç­‰çº§2ï¼š10ç§’
                    5,   // ç­‰çº§3ï¼š5ç§’
                    2,   // ç­‰çº§4ï¼š2ç§’
                    1    // ç­‰çº§5ï¼š1ç§’
                ];
                return durations[this.speedLevel];
            }
            
            addText() {
                if (warmTexts.length === 0 || this.textFrequencyLevel === 0) return;
                
                const text = document.createElement('div');
                text.className = 'floating-text';
                const textIndex = Math.floor(Math.random() * warmTexts.length);
			                text.textContent = warmTexts[textIndex];
			// åªåœ¨ä¸‹1/5å±å¹•æ˜¾ç¤ºï¼ˆå±å¹•åº•éƒ¨20%åŒºåŸŸï¼‰
			    const minTop = canvas.height * 0.7;  // å±å¹•75%ä½ç½®å¼€å§‹
			    const maxTop = canvas.height - 50;   // å±å¹•åº•éƒ¨å‡å»50pxè¾¹è·
			    const top = Math.random() * (maxTop - minTop) + minTop;
			    text.style.top = `${top}px`;
			    
			    const size = Math.floor(Math.random() * 4) + 14;
			    text.style.fontSize = `${size}px`;
			    text.style.color = colors[Math.floor(Math.random() * colors.length)];
			                // æ ¹æ®é€Ÿåº¦ç­‰çº§è®¾ç½®åŠ¨ç”»æŒç»­æ—¶é—´
                const duration = this.getSpeedDuration();
                text.style.animationDuration = `${duration}s`;
                
                this.container.appendChild(text);
                
                setTimeout(() => {
                    if (text.parentNode) {
                        text.parentNode.removeChild(text);
                    }
                }, duration * 1000);
            }
            
            // æ¸…é™¤æ‰€æœ‰æ¼‚æµ®æ–‡å­—
            clearAllTexts() {
                while (this.container.firstChild) {
                    this.container.removeChild(this.container.firstChild);
                }
            }
            
            update() {
                const now = Date.now();
                const interval = this.getFrequencyInterval();
                
                // å½“é¢‘ç‡ç­‰çº§ä»0å˜ä¸ºé0æ—¶ï¼Œé‡ç½®è®¡æ—¶å™¨
                if (this.lastFrequencyLevel === 0 && this.textFrequencyLevel > 0) {
                    this.lastTextTime = now;
                }
                
                if (now - this.lastTextTime > interval) {
                    this.addText();
                    this.lastTextTime = now;
                }
                
                this.lastFrequencyLevel = this.textFrequencyLevel;
            }
        }
        
        // åˆ›å»ºé£˜å±æ–‡å­—ç®¡ç†å™¨
        const textManager = new FloatingTextManager();
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            ctx.fillStyle = 'rgba(10, 5, 30, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
			// æ¸…é™¤ç”»å¸ƒä½†ä¸ç»˜åˆ¶åŠé€æ˜èƒŒæ™¯
			ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < fireworks.length; i++) {
                fireworks[i].update();
                fireworks[i].draw();
            }
            
            textManager.update();
            requestAnimationFrame(animate);
        }
        
        // å¯åŠ¨åŠ¨ç”»
        function startAnimation() {
            animate();
            setTimeout(() => {
                for (let i = 0; i < 1; i++) {
                    setTimeout(() => {
                        textManager.addText();
                    }, i * 10000);
                }
            }, 10000);
        }
        
        // æ§åˆ¶é¢æ¿äº‹ä»¶
        const fireworkFrequency = document.getElementById('fireworkFrequency');
        const textFrequency = document.getElementById('textFrequency');
        const textSpeed = document.getElementById('textSpeed');
        const musicVolume = document.getElementById('musicVolume');
        const soundVolume = document.getElementById('soundVolume');
        const panelButton = document.getElementById('panelButton');
        const tvButton = document.getElementById('tvButton');
        const controlPanel = document.getElementById('controlPanel');
        const tvBox = document.getElementById('tvBox');
        
        fireworkFrequency.addEventListener('input', function() {
            fireworkInterval = parseInt(this.value);
        });
        
        // æ–‡å­—é¢‘ç‡æ§åˆ¶ (0-5çº§)
        textFrequency.addEventListener('input', function() {
            const newLevel = parseInt(this.value);
            
            // å½“ä»0å˜ä¸ºé0æ—¶ï¼Œæ¸…é™¤æ‰€æœ‰æ–‡å­—
            if (textManager.textFrequencyLevel === 0 && newLevel > 0) {
                textManager.clearAllTexts();
                
                // æ˜¾ç¤ºé€šçŸ¥
                textNotification.classList.remove('hidden');
                setTimeout(() => {
                    textNotification.classList.add('hidden');
                }, 2000);
            }
            
            textManager.textFrequencyLevel = newLevel;
        });
        
        // æ–‡å­—é€Ÿåº¦æ§åˆ¶ (0-5çº§)
        textSpeed.addEventListener('input', function() {
            const newLevel = parseInt(this.value);
            
            // å½“é€Ÿåº¦æ”¹å˜æ—¶ï¼Œæ¸…é™¤æ‰€æœ‰æ–‡å­—
            if (textManager.speedLevel !== newLevel) {
                textManager.clearAllTexts();
                
                // æ˜¾ç¤ºé€šçŸ¥
                textNotification.classList.remove('hidden');
                setTimeout(() => {
                    textNotification.classList.add('hidden');
                }, 2000);
            }
            
            textManager.speedLevel = newLevel;
        });
        
        musicVolume.addEventListener('input', function() {
            backgroundMusic.volume = this.value / 100;
        });
        
        soundVolume.addEventListener('input', function() {
            fireworkSound.volume = this.value / 100;
        });
        
        let panelVisible = false;
        panelButton.addEventListener('click', function() {
            tvBox.classList.add('hidden');
            panelVisible = !panelVisible;
            controlPanel.classList.toggle('hidden', !panelVisible);
            this.innerHTML = panelVisible ? 
                '<i class="fas fa-times"></i> å…³é—­é¢æ¿' : 
                '<i class="fas fa-sliders-h"></i> æ§åˆ¶é¢æ¿';
        });
        
        let tvVisible = false;
        tvButton.addEventListener('click', function() {
            controlPanel.classList.add('hidden');
            panelVisible = false;
            panelButton.innerHTML = '<i class="fas fa-sliders-h"></i> æ§åˆ¶é¢æ¿';
            tvVisible = !tvVisible;
            tvBox.classList.toggle('hidden', !tvVisible);
            this.innerHTML = tvVisible ? 
                '<i class="fas fa-times"></i> å…³é—­ç”µè§†' : 
                '<i class="fas fa-tv"></i> å°ç”µè§†';
        });
        
        // å°ç”µè§†å›¾ç‰‡è½®æ’­
        function startImageCarousel() {
            const tvImages = document.querySelectorAll('.tv-image');
            let currentImageIndex = 0;
            
            function changeTvImage() {
                tvImages[currentImageIndex].classList.remove('active');
                currentImageIndex = (currentImageIndex + 1) % tvImages.length;
                tvImages[currentImageIndex].classList.add('active');
            }
            
            setInterval(changeTvImage, 4000);
        }
        
        // æ›´æ–°æ—¶é—´
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            document.getElementById('currentTime').textContent = `${hours}:${minutes}:${seconds}`;
        }
        
        // æ¨¡æ‹Ÿå¤©æ°”æ•°æ®
        function updateWeather() {
            const weatherTypes = ["æ™´", "å¤šäº‘", "å°é›¨", "é˜´å¤©", "é˜µé›¨"];
            const weather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
            const temp = Math.floor(Math.random() * 15) + 20;
            document.getElementById('weather').textContent = `${weather} ${temp}Â°C`;
        }
        
        
		function setupTripleClick() {
		    let clickCount = 0;
		    let lastClickTime = 0;
		    const tripleClickThreshold = 300; // 300mså†…ä¸‰æ¬¡ç‚¹å‡»
		    
		    document.addEventListener('click', (e) => {
		        // æ·»åŠ æŒ‰é’®å®¹å™¨åˆ°æ’é™¤åˆ—è¡¨
		        if (e.target.closest('.control-panel, .tv-box, .top-controls, .button-container')) {
		            return;
		        }
		        
		        const now = Date.now();
		        
		        if (now - lastClickTime > tripleClickThreshold) {
		            clickCount = 1;
		        } else {
		            clickCount++;
		        }
		        
		        lastClickTime = now;
		        
		        if (clickCount === 3) {
		            // åœ¨åˆ‡æ¢å‰æ£€æµ‹çŠ¶æ€
		            const wasHidden = buttonContainer.classList.contains('hidden');
		            
		            // åˆ‡æ¢æŒ‰é’®å®¹å™¨æ˜¾ç¤ºçŠ¶æ€
		            buttonContainer.classList.toggle('hidden');
		            
		            // å¦‚æœæŒ‰é’®ä»éšè—å˜ä¸ºæ˜¾ç¤ºï¼Œ5ç§’åè‡ªåŠ¨éšè—
		            if (wasHidden) {
		                // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
		                if (buttonContainer.hideTimeout) {
		                    clearTimeout(buttonContainer.hideTimeout);
		                }
		                
		                buttonContainer.hideTimeout = setTimeout(() => {
		                    buttonContainer.classList.add('hidden');
		                }, 5000);
		            } else {
		                // æŒ‰é’®è¢«éšè—ï¼Œæ¸…é™¤è‡ªåŠ¨éšè—å®šæ—¶å™¨
		                if (buttonContainer.hideTimeout) {
		                    clearTimeout(buttonContainer.hideTimeout);
		                }
		            }
		            
		            // é‡ç½®ç‚¹å‡»è®¡æ•°
		            clickCount = 0;
		        }
		    });
		    
		    // é˜»æ­¢æŒ‰é’®ç‚¹å‡»å†’æ³¡
		    buttonContainer.addEventListener('click', (e) => {
		        e.stopPropagation();
		    });
		}
				  // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        function setupFileUploads() {
            const applyUploadsButton = document.getElementById('applyUploadsButton');
            const bgMusicInput = document.getElementById('backgroundMusicUpload');
            const soundInput = document.getElementById('fireworkSoundUpload');
            const imageInput = document.getElementById('imageUpload');
            const textInput = document.getElementById('textUpload');
            
            const musicStatusEl = document.getElementById('musicUploadStatus');
            const soundStatusEl = document.getElementById('soundUploadStatus');
            const imageStatusEl = document.getElementById('imageUploadStatus');
            const textStatusEl = document.getElementById('textUploadStatus');
            
            // åº”ç”¨æ‰€æœ‰ä¸Šä¼ 
            applyUploadsButton.addEventListener('click', function() {
                // åº”ç”¨èƒŒæ™¯éŸ³ä¹
                if (bgMusicInput.files.length > 0) {
                    const file = bgMusicInput.files[0];
                    if (file.type.startsWith('audio/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const objectURL = URL.createObjectURL(file);
                            backgroundMusic.src = objectURL;
                            backgroundMusic.load();
                            
                            // å­˜å‚¨åˆ°localStorage
                            localStorage.setItem('customBackgroundMusic', objectURL);
                            
                            musicStatusEl.textContent = `å·²åº”ç”¨: ${file.name}`;
                            updateResourceStatus(musicStatus, 'local');
                            
                            // å°è¯•æ’­æ”¾æ–°éŸ³ä¹
                            backgroundMusic.play().catch(e => {
                                console.log('éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³é¢‘');
                            });
                        };
                        reader.readAsDataURL(file);
                    } else {
                        musicStatusEl.textContent = 'è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶';
                    }
                }
                
                // åº”ç”¨éŸ³æ•ˆ
                if (soundInput.files.length > 0) {
                    const file = soundInput.files[0];
                    if (file.type.startsWith('audio/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const objectURL = URL.createObjectURL(file);
                            fireworkSound.src = objectURL;
                            fireworkSound.load();
                            
                            // å­˜å‚¨åˆ°localStorage
                            localStorage.setItem('customFireworkSound', objectURL);
                            
                            soundStatusEl.textContent = `å·²åº”ç”¨: ${file.name}`;
                            updateResourceStatus(soundStatus, 'local');
                        };
                        reader.readAsDataURL(file);
                    } else {
                        soundStatusEl.textContent = 'è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶';
                    }
                }
                
                // åº”ç”¨å›¾ç‰‡
                if (imageInput.files.length > 0) {
                    const files = Array.from(imageInput.files);
                    const validImages = files.filter(file => file.type.startsWith('image/'));
                    const maxImages = Math.min(validImages.length, 4);
                    
                    for (let i = 0; i < maxImages; i++) {
                        const file = validImages[i];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const dataURL = e.target.result;
                            // å­˜å‚¨åˆ°localStorage
                            localStorage.setItem(`customImage${i}`, dataURL);
                            
                            // è®¾ç½®åˆ°ç”µè§†å›¾ç‰‡
                            const tvImages = document.querySelectorAll('.tv-image');
                            tvImages[i].style.backgroundImage = `url('${dataURL}')`;
                        };
                        reader.readAsDataURL(file);
                    }
                    
                    imageStatusEl.textContent = `å·²åº”ç”¨ ${maxImages} å¼ å›¾ç‰‡`;
                    updateResourceStatus(imageStatus, 'local');
                }
                
                // åº”ç”¨æ–‡å­—
                if (textInput.files.length > 0) {
                    const file = textInput.files[0];
                    if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            warmTexts = e.target.result.split('\n').filter(line => line.trim() !== '');
                            
                            // å­˜å‚¨åˆ°localStorage
                            localStorage.setItem('customWarmTexts', JSON.stringify(warmTexts));
                            
                            textStatusEl.textContent = `å·²åº”ç”¨: ${file.name}`;
                            updateResourceStatus(textStatus, 'local');
                            
                            // æ¸…é™¤ç°æœ‰æ–‡å­—å¹¶é‡æ–°å¼€å§‹
                            textManager.clearAllTexts();
                            textManager.lastTextTime = 0;
                        };
                        reader.readAsText(file);
                    } else {
                        textStatusEl.textContent = 'è¯·é€‰æ‹©æ–‡æœ¬æ–‡ä»¶(.txt)';
                    }
                }
                
                // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
                textNotification.textContent = "èµ„æºå·²æˆåŠŸåº”ç”¨å¹¶ä¿å­˜";
                textNotification.classList.remove('hidden');
                setTimeout(() => {
                    textNotification.classList.add('hidden');
                }, 2000);
            });
        }
// æ·»åŠ å…¨å±€å˜é‡ç®¡ç†æ¼©æ¶¡æ•ˆæœçŠ¶æ€
let vortexActive = false;
let vortexAnimationId = null;
let vortexVars = null;

// å°è£…æ¼©æ¶¡æ•ˆæœåˆå§‹åŒ–å‡½æ•°
function initVortexEffect() {
    const canvas = document.getElementById('vortexCanvas');
    if (!canvas) return;
    
    // åˆ›å»ºæ•ˆæœæ‰€éœ€å˜é‡
    vortexVars = {
        canvas: canvas,
        ctx: canvas.getContext('2d'),
        frameNo: 0,
        camX: 0,
        camY: 0,
        camZ: -14,
        pitch: 0,
        yaw: 0,
        cx: canvas.width/2,
        cy: canvas.height/2,
        bounding: 10,
        scale: 500,
        floor: 26.5,
        points: [],
        initParticles: 700,
        initV: .01,
        distributionRadius: 800,
        vortexHeight: 25
    };
    
    // è°ƒæ•´canvaså¤§å°
    function resizeVortexCanvas() {
        vortexVars.canvas.width = document.body.clientWidth;
        vortexVars.canvas.height = document.body.clientHeight;
        vortexVars.cx = vortexVars.canvas.width/2;
        vortexVars.cy = vortexVars.canvas.height/2;
    }
    resizeVortexCanvas();
    window.addEventListener('resize', resizeVortexCanvas);
    
    // æ·»åŠ ç²’å­æ•ˆæœæ‰€éœ€å‡½æ•° 
    function project3D(x,y,z,vars) {
        var p,d;
	x-=vars.camX;
	y-=vars.camY-8;
	z-=vars.camZ;
	p=Math.atan2(x,z);
	d=Math.sqrt(x*x+z*z);
	x=Math.sin(p-vars.yaw)*d;
	z=Math.cos(p-vars.yaw)*d;
	p=Math.atan2(y,z);
	d=Math.sqrt(y*y+z*z);
	y=Math.sin(p-vars.pitch)*d;
	z=Math.cos(p-vars.pitch)*d;
	var rx1=-1000;
	var ry1=1;
	var rx2=1000;
	var ry2=1;
	var rx3=0;
	var ry3=0;
	var rx4=x;
	var ry4=z;
	var uc=(ry4-ry3)*(rx2-rx1)-(rx4-rx3)*(ry2-ry1);
	var ua=((rx4-rx3)*(ry1-ry3)-(ry4-ry3)*(rx1-rx3))/uc;
	var ub=((rx2-rx1)*(ry1-ry3)-(ry2-ry1)*(rx1-rx3))/uc;
	if(!z)z=0.000000001;
	if(ua>0&&ua<1&&ub>0&&ub<1){
		return {
			x:vars.cx+(rx1+ua*(rx2-rx1))*vars.scale,
			y:vars.cy+y/z*vars.scale,
			d:(x*x+y*y+z*z)
		};
	}else{
		return { d:-1 };
	}
    }
    
    function elevation(x,y,z) {
      var dist = Math.sqrt(x*x+y*y+z*z);
	if(dist && z/dist>=-1 && z/dist <=1) return Math.acos(z / dist);
	return 0.00000001;
    }
    
    function rgb(col) {
        	col += 0.000001;
	var r = parseInt((0.5+Math.sin(col)*0.5)*16);
	var g = parseInt((0.5+Math.cos(col)*0.5)*16);
	var b = parseInt((0.5-Math.sin(col)*0.5)*16);
	return "#"+r.toString(16)+g.toString(16)+b.toString(16);
    }
    
function interpolateColors(RGB1,RGB2,degree){
	
	var w2=degree;
	var w1=1-w2;
	return [w1*RGB1[0]+w2*RGB2[0],w1*RGB1[1]+w2*RGB2[1],w1*RGB1[2]+w2*RGB2[2]];
}
 
 
function rgbArray(col){
 
	col += 0.000001;
	var r = parseInt((0.5+Math.sin(col)*0.5)*256);
	var g = parseInt((0.5+Math.cos(col)*0.5)*256);
	var b = parseInt((0.5-Math.sin(col)*0.5)*256);
	return [r, g, b];
}
 
 
function colorString(arr){
 
	var r = parseInt(arr[0]);
	var g = parseInt(arr[1]);
	var b = parseInt(arr[2]);
	return "#"+("0" + r.toString(16) ).slice (-2)+("0" + g.toString(16) ).slice (-2)+("0" + b.toString(16) ).slice (-2);
}
 
 
function process(vars){
 
 
	if(vars.points.length<vars.initParticles) for(var i=0;i<5;++i) spawnParticle(vars);
	var p,d,t;
	
	p = Math.atan2(vars.camX, vars.camZ);
	d = Math.sqrt(vars.camX * vars.camX + vars.camZ * vars.camZ);
	d -= Math.sin(vars.frameNo / 80) / 25;
	t = Math.cos(vars.frameNo / 300) / 165;
	vars.camX = Math.sin(p + t) * d;
	vars.camZ = Math.cos(p + t) * d;
	vars.camY = -Math.sin(vars.frameNo / 220) * 15;
	vars.yaw = Math.PI + p + t;
	vars.pitch = elevation(vars.camX, vars.camZ, vars.camY) - Math.PI / 2;
	
	var t;
	for(var i=0;i<vars.points.length;++i){
		
		x=vars.points[i].x;
		y=vars.points[i].y;
		z=vars.points[i].z;
		d=Math.sqrt(x*x+z*z)/1.0075;
		t=.1/(1+d*d/5);
		p=Math.atan2(x,z)+t;
		vars.points[i].x=Math.sin(p)*d;
		vars.points[i].z=Math.cos(p)*d;
		vars.points[i].y+=vars.points[i].vy*t*((Math.sqrt(vars.distributionRadius)-d)*2);
		if(vars.points[i].y>vars.vortexHeight/2 || d<.25){
			vars.points.splice(i,1);
			spawnParticle(vars);
		}
	}
}
 
function drawFloor(vars){
	
	var x,y,z,d,point,a;
	for (var i = -25; i <= 25; i += 1) {
		for (var j = -25; j <= 25; j += 1) {
			x = i*2;
			z = j*2;
			y = vars.floor;
			d = Math.sqrt(x * x + z * z);
			point = project3D(x, y-d*d/85, z, vars);
			if (point.d != -1) {
				size = 1 + 15000 / (1 + point.d);
				a = 0.15 - Math.pow(d / 50, 4) * 0.15;
				if (a > 0) {
					vars.ctx.fillStyle = colorString(interpolateColors(rgbArray(d/26-vars.frameNo/40),[0,128,32],.5+Math.sin(d/6-vars.frameNo/8)/2));
					vars.ctx.globalAlpha = a;
					vars.ctx.fillRect(point.x-size/2,point.y-size/2,size,size);
				}
			}
		}
	}		
	vars.ctx.fillStyle = "#82f";
	for (var i = -25; i <= 25; i += 1) {
		for (var j = -25; j <= 25; j += 1) {
			x = i*2;
			z = j*2;
			y = -vars.floor;
			d = Math.sqrt(x * x + z * z);
			point = project3D(x, y+d*d/85, z, vars);
			if (point.d != -1) {
				size = 1 + 15000 / (1 + point.d);
				a = 0.15 - Math.pow(d / 50, 4) * 0.15;
				if (a > 0) {
					vars.ctx.fillStyle = colorString(interpolateColors(rgbArray(-d/26-vars.frameNo/40),[32,0,128],.5+Math.sin(-d/6-vars.frameNo/8)/2));
					vars.ctx.globalAlpha = a;
					vars.ctx.fillRect(point.x-size/2,point.y-size/2,size,size);
				}
			}
		}
	}		
}
 
function sortFunction(a,b){
	return b.dist-a.dist;
}
 
function draw(vars){
 
	vars.ctx.globalAlpha=.15;
	vars.ctx.fillStyle="#000";
	vars.ctx.fillRect(0, 0, canvas.width, canvas.height);
	
	drawFloor(vars);
	
	var point,x,y,z,a;
	for(var i=0;i<vars.points.length;++i){
		x=vars.points[i].x;
		y=vars.points[i].y;
		z=vars.points[i].z;
		point=project3D(x,y,z,vars);
		if(point.d != -1){
			vars.points[i].dist=point.d;
			size=1+vars.points[i].radius/(1+point.d);
			d=Math.abs(vars.points[i].y);
			a = .8 - Math.pow(d / (vars.vortexHeight/2), 1000) * .8;
			vars.ctx.globalAlpha=a>=0&&a<=1?a:0;
			vars.ctx.fillStyle=rgb(vars.points[i].color);
			if(point.x>-1&&point.x<vars.canvas.width&&point.y>-1&&point.y<vars.canvas.height)vars.ctx.fillRect(point.x-size/2,point.y-size/2,size,size);
		}
	}
	vars.points.sort(sortFunction);
}
 
 
function spawnParticle(vars){
 
	var p,ls;
	pt={};
	p=Math.PI*2*Math.random();
	ls=Math.sqrt(Math.random()*vars.distributionRadius);
	pt.x=Math.sin(p)*ls;
	pt.y=-vars.vortexHeight/2;
	pt.vy=vars.initV/20+Math.random()*vars.initV;
	pt.z=Math.cos(p)*ls;
	pt.radius=200+800*Math.random();
	pt.color=pt.radius/1000+vars.frameNo/250;
	vars.points.push(pt);	
}
 
    // å¯åŠ¨åŠ¨ç”»å¾ªç¯
    function vortexFrame() {
        process(vortexVars);
        draw(vortexVars);
        vortexAnimationId = requestAnimationFrame(vortexFrame);
    }
    vortexAnimationId = requestAnimationFrame(vortexFrame);
}

// é”€æ¯æ¼©æ¶¡æ•ˆæœ
function destroyVortexEffect() {
    if (vortexAnimationId) {
        cancelAnimationFrame(vortexAnimationId);
        vortexAnimationId = null;
    }
    
    const canvas = document.getElementById('vortexCanvas');
    if (canvas) {
        canvas.style.display = 'none';
    }
    
    vortexVars = null;
    vortexActive = false;
}


// é£æš´æ¼©æ¶¡æŒ‰é’®äº‹ä»¶
document.getElementById('beijingButton').addEventListener('click', function() {
    const canvas = document.getElementById('vortexCanvas');
    
    if (vortexActive) {
        // å…³é—­æ•ˆæœ
        destroyVortexEffect();
        this.innerHTML = '<i class="fas fa-landmark"></i> é£æš´æ¼©æ¶¡';
        showNotification('æ¼©æ¶¡æ•ˆæœå·²å…³é—­');
    } else {
        // æ˜¾ç¤ºæ•ˆæœ
        canvas.style.display = 'block';
        
        if (!vortexVars) {
            initVortexEffect();
        }
        
        vortexActive = true;
        this.innerHTML = '<i class="fas fa-landmark"></i> å…³é—­æ¼©æ¶¡';
        showNotification('é£æš´æ¼©æ¶¡æ•ˆæœå·²å¼€å¯');
    }
});
        
        
        
        
        
        
        // åˆå§‹åŒ–åº”ç”¨
        function init() {
            calculateDaysTogether();
            setInterval(updateTime, 1000);
            setInterval(updateWeather, 30000);
            setInterval(calculateDaysTogether, 60000);
            
            initResources().then(() => {
                startAnimation();
                startImageCarousel();
                updateWeather();
                setupTripleClick();
                setupFileUploads();
            });
            
				// è·å–æ–°æŒ‰é’®å…ƒç´ 
				const xinjiangButton = document.getElementById('xinjiangButton');
				const chongqingButton = document.getElementById('chongqingButton');
				const shanghaiButton = document.getElementById('shanghaiButton');
				const foodButton = document.getElementById('foodButton');
				
				
				
				
				
				// è·å–æ‰€æœ‰çœä»½æŒ‰é’®å¹¶æ·»åŠ ç‚¹å‡»äº‹ä»¶
			    const provinces = [
			        'beijing', 'tianjin', 'hebei', 'shanxi', 'neimenggu', 
			        'liaoning', 'jilin', 'heilongjiang', 'shanghai', 'jiangsu',
			        'zhejiang', 'anhui', 'fujian', 'jiangxi', 'shandong',
			        'henan', 'hubei', 'hunan', 'guangdong', 'guangxi',
			        'hainan', 'chongqing', 'sichuan', 'guizhou', 'yunnan',
			        'xizang', 'shaanxi', 'gansu', 'qinghai', 'ningxia',
			        'xinjiang', 'taiwan', 'xianggang', 'aomen'
			    ];
			    
			    provinces.forEach(province => {
			        const button = document.getElementById(`${province}Button`);
			        if (button) {
			            button.addEventListener('click', function() {
			                // è·å–çœä»½ä¸­æ–‡åï¼ˆä»æŒ‰é’®æ–‡æœ¬ä¸­æå–ï¼‰
			                const provinceName = this.textContent.trim();
			                //showNotification(`å°ç‡•å­ï¼šæ¬¢è¿æ¥åˆ°${provinceName}ï¼`);
			                
			                // è§¦å‘çƒŸèŠ±æ•ˆæœ
			                triggerSpecialFireworks(provinceName);
			            });
			        }
			    });
				
				// æ–°å¢å‡½æ•°ï¼šæ˜¾ç¤ºé€šçŸ¥
				function showNotification(message) {
				    textNotification.textContent = message;
				    textNotification.classList.remove('hidden');
				    setTimeout(() => {
				        textNotification.classList.add('hidden');
				    }, 2000);
				}
				
			// åˆ›å»ºæ¼©æ¶¡canvasï¼ˆåˆå§‹éšè—ï¼‰
    const vortexCanvas = document.createElement('canvas');
    vortexCanvas.id = 'vortexCanvas';
    vortexCanvas.style.position = 'absolute';
    vortexCanvas.style.top = '0';
    vortexCanvas.style.left = '0';
    vortexCanvas.style.width = '100%';
    vortexCanvas.style.height = '100%';
    vortexCanvas.style.zIndex = '0';
    vortexCanvas.style.display = 'none';
    document.querySelector('.container').appendChild(vortexCanvas);
    
				
				
				
            
		// æ–°å¢å‡½æ•°ï¼šè§¦å‘ç‰¹æ®ŠçƒŸèŠ±æ•ˆæœ
			function triggerSpecialFireworks(province) {
			    // è¿™é‡Œå¯ä»¥æ·»åŠ ç‰¹å®šçœä»½çš„ç‰¹æ®Šæ•ˆæœ
			    for(let i = 0; i < 1; i++) {
			        setTimeout(() => {
			           // const firework = new Firework();
			            //firework.targetY = Math.random() * canvas.height * 0.3 + 50;
			            //fireworks.push(firework);
					
			            
			            
			        }, i * 20000);
			        
			    } 
			}       
        }
        
        
        
        
        
        
        
        
        
        
        
        window.addEventListener('orientationchange', resizeCanvas);
        init();
    </script>
    
</body>
</html>
